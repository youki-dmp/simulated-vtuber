<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áñë‰ººVtuberÈÖç‰ø°„Ç∑„Éü„É•„É¨„Éº„Çø„Éº v3.0</title>
    <style>
        :root {
            --bg: #0f0f0f;
            --surface: #1e1e1e;
            --accent: #ff0000;
            --text: #ffffff;
            --text-dim: #aaaaaa;
            --chat-bg: rgba(0, 0, 0, 0.4);
            
            /* SC Colors */
            --sc-1: #1565c0; /* Blue < 200 */
            --sc-2: #00b8d4; /* Light Blue < 500 */
            --sc-3: #00bfa5; /* Green < 1000 */
            --sc-4: #ffb300; /* Yellow < 2000 */
            --sc-5: #e65100; /* Orange < 5000 */
            --sc-6: #c2185b; /* Magenta < 10000 */
            --sc-7: #d32f2f; /* Red >= 10000 */
        }
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: "YouTube Sans", Roboto, Arial, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        /* Main Streaming Area */
        #main-stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: #000;
        }
        #video-container {
            flex: 1;
            display: grid;
            place-items: center;
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
            position: relative;
            overflow: hidden;
        }
        #camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        #overlay-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }
        .ui-row { display: flex; gap: 10px; }
        .live-badge {
            background: var(--accent);
            padding: 2px 8px;
            border-radius: 2px;
            font-weight: bold;
            font-size: 14px;
        }
        .viewer-count {
            background: rgba(0,0,0,0.6);
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 14px;
            transition: color 0.3s;
        }
        .viewer-count.rising { color: #24e08a; font-weight: bold; }
        .viewer-count.falling { color: #ff4d4d; }

        #stream-title-display {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        /* Super Chat Notification */
        #sc-notification-area {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            z-index: 20;
            pointer-events: none;
        }
        .sc-banner {
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: scPop 5s forwards;
            opacity: 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        @keyframes scPop {
            0% { opacity: 0; transform: translateY(-50px) scale(0.8); }
            10% { opacity: 1; transform: translateY(0) scale(1.05); }
            15% { transform: scale(1); }
            85% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-20px) scale(0.9); }
        }
        .sc-banner .amount { font-size: 32px; font-weight: 900; margin-bottom: 5px; }

        /* Side Chat Area */
        #chat-sidebar {
            width: 380px;
            background: var(--bg);
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        #chat-header {
            padding: 15px;
            border-bottom: 1px solid #333;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .message {
            display: flex;
            gap: 10px;
            font-size: 13px;
            line-height: 1.4;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .user-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .user-name {
            color: var(--text-dim);
            font-weight: bold;
            margin-right: 5px;
        }
        .message-content { word-break: break-all; }

        /* Super Chat in Feed */
        .message.sc {
            padding: 10px;
            border-radius: 8px;
            flex-direction: column;
            gap: 5px;
            color: white;
        }
        .message.sc .sc-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 5px;
        }

        /* Controls Area */
        #controls {
            padding: 20px;
            background: var(--surface);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .config-row { display: flex; gap: 10px; align-items: center; }
        input, button {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #444;
            background: #2a2a2a;
            color: white;
            font-size: 14px;
        }
        button {
            cursor: pointer;
            background: #333;
            font-weight: bold;
            transition: 0.2s;
        }
        button:hover { background: #444; }
        button.primary { background: #065fd4; border: none; }
        button.recording { background: var(--accent); border: none; }

        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-dim);
            cursor: pointer;
        }

        #transcript {
            font-size: 14px;
            color: #24e08a;
            height: 1.5em;
            overflow: hidden;
            font-style: italic;
            background: rgba(0,0,0,0.2);
            padding: 5px 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="main-stage">
        <div id="video-container">
            <video id="camera-feed" autoplay playsinline muted></video>
            <div id="sc-notification-area"></div>
            <div id="overlay-ui">
                <div class="ui-row">
                    <div class="live-badge">LIVE</div>
                    <div class="viewer-count" id="v-count">Ë¶ñËÅ¥ËÄÖ: ---‰∫∫</div>
                </div>
                <div id="stream-title-display"></div>
            </div>
        </div>
        <div id="controls">
            <div id="transcript">„ÄåÈÖç‰ø°ÈñãÂßã„Äç„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„Éû„Ç§„ÇØ„ÅåON„Å´„Å™„Çä„Åæ„Åô...</div>
            <div class="config-row">
                <input type="text" id="stream-title" placeholder="ÈÖç‰ø°„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ (‰æã: ÈõëË´áÈÖç‰ø°ÔºÅ)" style="flex: 1;">
                <input type="password" id="api-key" placeholder="Gemini API Key" style="width: 150px;">
                <label class="mode-toggle">
                    <input type="checkbox" id="offline-mode"> „Ç™„Éï„É©„Ç§„É≥(API‰∏ç‰ΩøÁî®)
                </label>
                <button id="btn-start" class="primary">üéôÔ∏è ÈÖç‰ø°ÈñãÂßã</button>
            </div>
        </div>
    </div>

    <div id="chat-sidebar">
        <div id="chat-header">
            <span>„Éà„ÉÉ„Éó„ÉÅ„É£„ÉÉ„Éà</span>
            <span style="color: var(--text-dim); font-size: 12px;">‚ñº</span>
        </div>
        <div id="chat-messages">
            <!-- Messages appear here -->
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const btnStart = document.getElementById('btn-start');
        const transcriptEl = document.getElementById('transcript');
        const apiKeyInput = document.getElementById('api-key');
        const titleInput = document.getElementById('stream-title');
        const titleDisplay = document.getElementById('stream-title-display');
        const offlineToggle = document.getElementById('offline-mode');
        const video = document.getElementById('camera-feed');
        const scArea = document.getElementById('sc-notification-area');
        const viewerDisplay = document.getElementById('v-count');

        let isStreaming = false;
        let recognition = null;
        let streamTitle = "ÁÑ°È°å„ÅÆÈÖç‰ø°";
        let currentViewers = 120;
        let lastSpeechTime = Date.now();

        // --- Mock Comments Data ---
        const genericComments = [
            "„Åç„Åü„ÅÇ„ÅÇ„ÅÇ„ÅÇ", "ÂæÖ„Å£„Å¶„ÅüÔºÅ", "„Åì„Çì„Åö„Çì„Å†„ÉºÔºÅ", "„Åì„Çì„ÇÅ„Åü„ÇìÔºÅ", "88888888", "Ê•Ω„Åó„Åø„Åô„Åé„Çã„Å™",
            "„Åã„Çè„ÅÑ„ÅÑ", "„Å¶„Åá„Å¶„Åá...", "„Åü„Åô„Åã„Çã", "Ëçâ", "ÔΩóÔΩóÔΩó", "Â§ßËçâÂéü", "ÔºÅÔºü", "„Éû„Ç∏„ÅãÔΩó", "„Çè„Åã„Çã„Çè„Éº",
            "Á•ûÈÖç‰ø°„ÅÆ‰∫àÊÑü", "ÂÅ•Â∫∑„Å´„ÅÑ„ÅÑ", "‰ªäÊó•„ÇÇÈÖç‰ø°„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ", "„Åï„Åô„Åå„Åß„Åô", "„Åä„Å§„Åä„Å§", "„Ç¨„ÉÅÔºü",
            "„Åà„Å£ÔºÅÔºü", "„Åù„Çì„Å™„Éê„Ç´„Å™ÔΩó", "„Åó„Å£„Å¶„Åü", "„Éä„Ç§„Çπ„ÉëÔºÅ", "„Å™„ÅÑ„Åô„ÅÖÔºÅ", "ÂØåË±™„Åç„ÅüÔΩó",
            "‰ªäÂåóÁî£Ê•≠", "„Ç¢„Éº„Ç´„Ç§„Éñ„ÅßË¶ãÁõ¥„Åô„Çè", "Â∫ÉÂëä„Åã„ÇâÊù•„Åæ„Åó„Åü", "Â£∞„ÅåÂ•Ω„Åç„Åô„Åé„Çã", "Áôí„ÇÑ„ÅóÊû†„Å†...",
            "Âàá„ÇäÊäú„Åç„Åã„ÇâÊù•„Åæ„Åó„ÅüÔºÅ", "„Éñ„É©„Ç¶„Ç∂„Éê„ÉÉ„ÇØ‰∏çÂèØÈÅø", "ÂàùË¶ã„Åß„ÅôÔºÅÂøúÊè¥„Åó„Å¶„Åæ„Åô", "100‰∏áÂõûÂÜçÁîü„ÅÑ„Åë",
            "‰ªä„ÅÆÊúÄÈ´ò„Å†„Å£„ÅüÔΩó", "ÁîªÈù¢Èå≤Áîª„Åó„Åü„Çè", "„Åì„Çå„ÅûV„ÅÆÈÜçÈÜêÂë≥", "Êé®„Åó„ÅåÂ∞ä„ÅÑ", "‰∏ÄÊ∞ó„Å´ÁõÆ„ÅåË¶ö„ÇÅ„Åü"
        ];

        const keywordResponses = {
            "„Åì„Çì„Å´„Å°„ÅØ": ["„Åì„Çì„Åö„Çì„Å†„ÉºÔºÅ", "„Åì„Çì„Å°„ÇÉÔºÅ", "„Åì„Çì„Å´„Å°„ÅØ„ÉºÔºÅ", "ÂæÖ„Å£„Å¶„Åü„ÇàÔºÅ"],
            "„Åì„Çì„Å∞„Çì„ÅØ": ["„Åì„Çì„Å∞„Çì„Çè„Çì", "„Åì„Çì„ÇÅ„Åü„ÇìÔºÅ", "„Åì„Çì„Å∞„Çì„ÅØ„Éº", "Â§úÊõ¥„Åã„ÅóÂä©„Åã„Çã"],
            "„ÅÇ„Çä„Åå„Å®„ÅÜ": ["„Åì„Å°„Çâ„Åì„Åù„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ", "„Åü„Åô„Åã„Çã", "„ÅÑ„ÅÑ„Åà„ÉºÔºÅ", "Â∞ä„ÅÑ..."],
            "„Åã„Çè„ÅÑ„ÅÑ": ["„Çè„Åã„Çã", "„Å¶„Åá„Å¶„Åá...", "„Åã„Çè„ÅÑ„ÅÑ„Å™„ÅÆ„Å†ÔºÅ", "Â§©‰Ωø„ÅãÔºü", "„Åù„Çå„Å™"],
            "„Åã„Å£„Åì„ÅÑ„ÅÑ": ["„Åù„Çå„Å™", "ÊúÄÈ´òÔºÅ", "„Ç§„Ç±„É°„É≥„Åô„Åé„ÇãÔΩó", "ÊÉö„Çå„Çã„Çè"],
            "„Åô„Åî„ÅÑ": ["Â§©Êâç„ÅãÔºü", "„Åï„Åô„Åå„Å†„Çè", "„Åä„Åä„Åä„Åä", "„Éó„É≠„ÅÆ‰ªïÊ•≠„Å†...", "ÊÑüÂãï„Åó„Åü"],
            "Ëçâ": ["Ëçâ", "ÔΩóÔΩóÔΩó", "Â§ßËçâÂéü‰∏çÂèØÈÅø", "„Åä„ÅÑ„ÇÑ„ÇÅ„ÇçÔΩó", "ËÖπÁ≠ãÂ¥©Â£äÔΩó"],
            "w": ["ÔΩóÔΩóÔΩó", "ËçâÁîü„Åà„Çã", "„Çè„Çç„Åü", "„ÇÇ„Å£„Å®„ÇÑ„ÇåÔΩó", "Âπ≥Âíå„Åã„Çà"],
            "Áñ≤„Çå„Åü": ["„ÅäÁñ≤„ÇåÊßòÔºÅ", "„ÇÜ„Å£„Åè„Çä‰ºë„Çì„Åß„Å≠", "„Çà„Åó„Çà„Åó", "ÁÑ°ÁêÜ„Åó„Å™„ÅÑ„Åß„Å≠", "Áôí„ÇÑ„Åó„Å¶„ÅÇ„Åí„Çã„Çà"],
            "„Çπ„Éë„ÉÅ„É£": ["„Éä„Ç§„Çπ„ÉëÔºÅ", "„Å™„ÅÑ„Åô„Å±„ÉºÔºÅ", "Áü≥Ê≤πÁéã„Åç„ÅüÔΩó", "ÂØåË±™„ÅÆÈÅä„Å≥„Å†...", "„Éä„Ç§„Çπ„Éë„Åß„ÅôÔºÅ"],
            "„ÅäÁñ≤„Çå": ["„Åä„Å§„Åä„Å§ÔºÅ", "‰πôÔºÅ", "Ê•Ω„Åó„Åã„Å£„Åü„Çà„ÉºÔºÅ", "„Åæ„ÅüÊòéÊó•„Å≠", "„ÅäÁñ≤„ÇåÊßò„Åß„Åó„ÅüÔºÅ"],
            "ÁµÇ„Çè": ["„Åà„ÉºÔºÅ„ÇÇ„ÅÜÔºü", "„Åä„Å§„Åä„Å§", "Ê•Ω„Åó„Åã„Å£„ÅüÔºÅ", "Ê¨°„ÅØ„ÅÑ„Å§Ôºü", "ÂØÇ„Åó„ÅÑ„Å™"],
            "Ê≠å": ["Ê≠åÂä©„Åã„Çã", "Á•ûÊõ≤„Åç„Åü", "È≥•ËÇå„Åü„Å£„Åü", "CDÂá∫„Åó„Å¶„Åè„ÇåÔΩó"],
            "„Ç≤„Éº„É†": ["‰ªä„ÅÆÊìç‰ΩúÁ•û„ÅãÔºü", "„ÅÜ„Åæ„Åô„Åé„ÇãÔΩó", "„Éâ„É≥„Éû„Ç§ÔºÅ", "Ê¨°„ÅÑ„Åì„ÅÜÔºÅ"],
            "Èü≥Èáè": ["Èü≥ÈáèÂ§ß‰∏àÂ§´„Å†„Çà„Éº", "„Å°„Çá„Å£„Å®Â§ß„Åç„ÅÑ„Åã„ÇÇÔºü", "„Å°„Çá„ÅÜ„Å©„ÅÑ„ÅÑÔºÅ"],
            "„É©„Ç∞": ["„Åì„Å£„Å°„ÇÇ„É©„Ç∞„ÅÑ„Åã„ÇÇ", "„É™„É≠„Éº„Éâ„Åó„Å¶„Åç„Åü", "Ê≠¢„Åæ„Å£„ÅüÔºÅÔºü"],
            "ÊîæÈÄÅ‰∫ãÊïÖ": ["„Åä„ÅÑ„ÇÑ„ÇÅ„ÇçÔΩó", "ÊîæÈÄÅ‰∫ãÊïÖÔΩóÔΩóÔΩó", "‰ºùË™¨„ÅÆÂõû„Åç„Åü„Å™"]
        };

        const randomNames = [
            "ÂêçÁÑ°„Åó", "ÈÄö„Çä„Åô„Åå„Çä", "Â∏∏ÈÄ£„Åï„Çì", "ROMÂ∞Ç", "Â§™ÂÆ¢", "ÂàùË¶ã„Åï„Çì", "„Åö„Çì„Å†„ÇÇ„ÇìLOVE", "„ÇÅ„Åü„ÇìÊé®„Åó", 
            "AI‰ø°ËÄÖ", "ÂåøÂêçÂ∏åÊúõ", "Áü≥Ê≤πÁéã", "Âàá„ÇäÊäú„ÅçËÅ∑‰∫∫", "„Ç¨„ÉÅÊÅãÂã¢", "ÈôêÁïå„Ç™„Çø„ÇØ", "„Çπ„Éë„ÉÅ„É£ÂæÖÊ©üÂã¢",
            "Êµ∑Â§ñ„Éã„Ç≠", "‰ΩéË©ï‰æ°„ÅÆ‰∫∫", "ÂÖ¨ÂºèÔºàÂÅΩÁâ©Ôºâ", "ËøëÊâÄ„ÅÆÁå´", "Áù°Áú†‰∏çË∂≥", "Á§æÁïú„É™„Çπ„Éä„Éº", "Â≠¶Áîü„É™„Çπ„Éä„Éº"
        ];

        // Init Web Speech API
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'ja-JP';

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }

                if (finalTranscript || interimTranscript) {
                    transcriptEl.textContent = "üéôÔ∏è " + (finalTranscript || interimTranscript);
                    lastSpeechTime = Date.now();
                }

                if (finalTranscript) {
                    if (offlineToggle.checked) {
                        generateOfflineComments(finalTranscript);
                    } else {
                        generateComments(finalTranscript);
                    }
                }
            };

            recognition.onerror = (e) => console.error(e);
        }

        btnStart.onclick = async () => {
            if (isStreaming) {
                location.reload();
                return;
            }

            if (!offlineToggle.checked && !apiKeyInput.value) {
                alert("Gemini API Key„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà„Åæ„Åü„ÅØ„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ„ÇíON„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ");
                return;
            }

            streamTitle = titleInput.value || "ÈõëË´áÈÖç‰ø°‰∏≠ÔºÅ";
            titleDisplay.textContent = streamTitle;

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                video.srcObject = stream;
                isStreaming = true;
                btnStart.textContent = "‚èπÔ∏è ÈÖç‰ø°ÁµÇ‰∫Ü";
                btnStart.classList.add('recording');
                transcriptEl.textContent = "üéôÔ∏è „Éû„Ç§„ÇØÊúâÂäπÔºöÂñã„Å£„Å¶„Åè„Å†„Åï„ÅÑ...";
                recognition.start();
                addMessage("System", `„Äå${streamTitle}„Äç„ÇíÈñãÂßã„Åó„Åæ„Åó„ÅüÔºÅ${offlineToggle.checked ? '(„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ)' : ''}`);
                startViewerDynamics();
                if (offlineToggle.checked) startOfflineRandomChat();
            } catch (err) {
                alert("„Ç´„É°„É©„Åæ„Åü„ÅØ„Éû„Ç§„ÇØ„ÅÆË®±ÂèØ„ÅåÂøÖË¶Å„Åß„Åô");
            }
        };

        // --- Gemini AI Logic ---
        async function generateComments(text) {
            const apiKey = apiKeyInput.value;
            const prompt = `„ÅÇ„Å™„Åü„ÅØ„Äå${streamTitle}„Äç„Å®„ÅÑ„ÅÜ„Çø„Ç§„Éà„É´„ÅÆVtuberÈÖç‰ø°„ÇíË¶ñËÅ¥„Åó„Å¶„ÅÑ„ÇãÁÜ±ÁãÇÁöÑ„Å™„É™„Çπ„Éä„Éº„Åü„Å°„Åß„Åô„ÄÇ
‰ªä„ÄÅÈÖç‰ø°ËÄÖ„Åå„Äå${text}„Äç„Å®Âñã„Çä„Åæ„Åó„Åü„ÄÇ
„Åì„Çå„Å´ÂØæ„Åó„Å¶„ÄÅ5„Äú8‰∫∫„ÅÆÁï∞„Å™„ÇãÂÄãÊÄß„ÇíÊåÅ„Å§„É™„Çπ„Éä„Éº„Å´„Å™„Çä„Åç„Å£„Å¶„ÄÅÁü≠„ÅÑ„ÉÅ„É£„ÉÉ„Éà„Ç≥„É°„É≥„ÉàÔºà15ÊñáÂ≠ó‰ª•ÂÜÖÔºâ„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
ÂÆüÈöõ„ÅÆYouTube Live„ÅÆ„ÉÅ„É£„ÉÉ„ÉàÊ¨Ñ„ÅÆ„Çà„ÅÜ„Å™„ÄÅ„É™„Ç¢„É™„ÉÜ„Ç£„ÅÆ„ÅÇ„Çã„Éç„ÉÉ„Éà„Çπ„É©„É≥„Ç∞„ÇÑÂèçÂøú„ÇíÊ∑∑„Åú„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

‚ñ†„Ç≥„É°„É≥„Éà„ÅÆ„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥‰æãÔºö
- ÂÆöÁï™„ÅÆÂèçÂøúÔºà„Åì„ÇìV„ÄÅ„Åç„Åü„ÅÇ„ÅÇ„ÄÅ8888„ÄÅ„Åù„Çå„Å™„ÄÅ„Çè„Åã„ÇãÔºâ
- „Éç„ÉÉ„Éà„Çπ„É©„É≥„Ç∞ÔºàËçâ„ÄÅw„ÄÅ„Å¶„Åá„Å¶„Åá„ÄÅ„Åü„Åô„Åã„Çã„ÄÅ‰ªäÂåóÁî£Ê•≠Ôºâ
- ÈÖç‰ø°ÂÜÖÂÆπ„Å∏„ÅÆ„ÉÑ„ÉÉ„Ç≥„Éü„ÄÅÈ©ö„Åç„ÄÅÂøúÊè¥
- „Åü„Åæ„Å´„Äå„Çπ„Éë„ÉÅ„É£(Êäï„ÅíÈä≠)„Äç„ÇíÈÄÅ„ÇãÔºàÂêçÂâçÔºö„Äê„Çπ„Éë„ÉÅ„É£1000ÂÜÜ„Äë„Ç≥„É°„É≥„ÉàÔºâ

‚ñ†„Çπ„Éë„ÉÅ„É£ÈáëÈ°ç„ÅÆ„É¨„Ç¢Â∫¶Ôºö100ÂÜÜ„Äú500ÂÜÜ(„Çà„Åè„ÅÇ„Çã), 1000ÂÜÜ„Äú3000ÂÜÜ(„Åü„Åæ„Å´„ÅÇ„Çã), 5000ÂÜÜ(„É¨„Ç¢), 10000ÂÜÜ(Ë∂ÖÊøÄ„É¨„Ç¢)
Âá∫ÂäõÂΩ¢ÂºèÔºö ÂêçÂâçÔºö„Ç≥„É°„É≥„Éà („Çπ„Éë„ÉÅ„É£„ÅØ ÂêçÂâçÔºö„Äê„Çπ„Éë„ÉÅ„É£1000ÂÜÜ„Äë„Ç≥„É°„É≥„Éà)`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                const resultText = data.candidates[0].content.parts[0].text;
                const lines = resultText.split('\n').filter(l => l.includes('Ôºö') || l.includes(':'));
                
                lines.forEach((line, i) => {
                    setTimeout(() => {
                        const parts = line.split(/[Ôºö:]/);
                        const name = parts[0].trim();
                        const content = parts.slice(1).join('Ôºö').trim();
                        processComment(name, content);
                    }, i * 800 + Math.random() * 500);
                });
            } catch (err) {
                console.error("Gemini API Error:", err);
                addMessage("System", "AIÊé•Á∂ö„Ç®„É©„Éº„ÄÇ„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô„ÅãÔºü");
            }
        }

        // --- Offline Mock Logic ---
        function generateOfflineComments(text) {
            const count = Math.floor(Math.random() * 3) + 2;
            let responses = [];
            
            // Check keywords
            for (const kw in keywordResponses) {
                if (text.includes(kw)) {
                    responses.push(...keywordResponses[kw]);
                }
            }

            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const name = randomNames[Math.floor(Math.random() * randomNames.length)];
                    let content = "";
                    if (responses.length > 0 && Math.random() > 0.3) {
                        content = responses[Math.floor(Math.random() * responses.length)];
                    } else {
                        content = genericComments[Math.floor(Math.random() * genericComments.length)];
                    }
                    
                    // Small chance of SC even in offline mode
                    if (Math.random() < 0.05) {
                        const amounts = [100, 200, 500, 1000, 2000, 5000, 10000];
                        const amount = amounts[Math.floor(Math.random() * amounts.length)];
                        addSuperChat(name, amount, content);
                    } else {
                        addMessage(name, content);
                    }
                }, i * 1000 + Math.random() * 1000);
            }
        }

        function startOfflineRandomChat() {
            // Even if not talking, some comments pop up
            setInterval(() => {
                if (!isStreaming) return;
                if (Math.random() < 0.3) {
                    const name = randomNames[Math.floor(Math.random() * randomNames.length)];
                    const content = genericComments[Math.floor(Math.random() * genericComments.length)];
                    addMessage(name, content);
                }
            }, 5000);
        }

        function processComment(name, content) {
            if (content.includes('„Äê„Çπ„Éë„ÉÅ„É£')) {
                const amountMatch = content.match(/„Äê„Çπ„Éë„ÉÅ„É£(\d+)ÂÜÜ„Äë/);
                let amount = amountMatch ? parseInt(amountMatch[1]) : 1000;
                const cleanContent = content.replace(/„Äê„Çπ„Éë„ÉÅ„É£\d+ÂÜÜ„Äë/, '').trim();
                
                if (amount >= 5000 && Math.random() > 0.1) {
                    if (Math.random() > 0.5) addMessage(name, cleanContent);
                    else addSuperChat(name, 500, cleanContent);
                    return;
                }
                addSuperChat(name, amount, cleanContent);
            } else {
                addMessage(name, content);
            }
        }

        function getSCColor(amount) {
            if (amount < 200) return 'var(--sc-1)';
            if (amount < 500) return 'var(--sc-2)';
            if (amount < 1000) return 'var(--sc-3)';
            if (amount < 2000) return 'var(--sc-4) text-black'; // Bright yellow
            if (amount < 5000) return 'var(--sc-5)';
            if (amount < 10000) return 'var(--sc-6)';
            return 'var(--sc-7)';
        }

        function addMessage(name, content) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            const colors = ['#ff4d4d', '#4d94ff', '#24e08a', '#ff9500', '#9d4dff'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            msgDiv.innerHTML = `<div class="user-icon" style="background-color: ${color}"></div><div class="message-body"><span class="user-name">${name}</span><span class="message-content">${content}</span></div>`;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addSuperChat(name, amount, content) {
            const scColorClass = getSCColor(amount);
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message sc';
            msgDiv.style.backgroundColor = scColorClass.includes('var') ? scColorClass.split(' ')[0] : scColorClass;
            if (scColorClass.includes('text-black')) msgDiv.style.color = 'black';
            
            msgDiv.innerHTML = `<div class="sc-header"><span>${name}</span><span>Ôø•${amount.toLocaleString()}</span></div><div class="message-content">${content}</div>`;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            const banner = document.createElement('div');
            banner.className = 'sc-banner';
            banner.style.backgroundColor = msgDiv.style.backgroundColor;
            if (scColorClass.includes('text-black')) banner.style.color = 'black';
            banner.innerHTML = `<div style="font-weight: bold; font-size: 14px;">${name}</div><div class="amount">Ôø•${amount.toLocaleString()}</div><div style="font-size: 18px;">${content}</div>`;
            scArea.innerHTML = '';
            scArea.appendChild(banner);
            
            setTimeout(() => {
                const reactions = ["„Éä„Ç§„Çπ„ÉëÔºÅ", "888888", "„Å™„ÅÑ„Åô„Å±„ÉºÔºÅ", "„Éä„Ç§„Çπ„Éë„Åß„ÅôÔºÅ"];
                const count = Math.floor(Math.random() * 3) + 2;
                for(let i=0; i<count; i++) {
                    setTimeout(() => addMessage(randomNames[Math.floor(Math.random()*randomNames.length)], reactions[Math.floor(Math.random()*reactions.length)]), i * 300 + Math.random() * 200);
                }
            }, 1000);
            setTimeout(() => banner.remove(), 5000);
            if (amount >= 5000) {
                currentViewers += Math.floor(Math.random() * 50) + 20;
                viewerDisplay.classList.add('rising');
                setTimeout(() => viewerDisplay.classList.remove('rising'), 2000);
            }
        }

        function startViewerDynamics() {
            setInterval(() => {
                const timeSinceLastSpeech = (Date.now() - lastSpeechTime) / 1000;
                if (timeSinceLastSpeech < 5) {
                    currentViewers += Math.floor(Math.random() * 5);
                    viewerDisplay.className = 'viewer-count rising';
                } else if (timeSinceLastSpeech > 15) {
                    currentViewers -= Math.floor(Math.random() * 3);
                    viewerDisplay.className = 'viewer-count falling';
                } else {
                    currentViewers += Math.floor(Math.random() * 3) - 1;
                    viewerDisplay.className = 'viewer-count';
                }
                if (currentViewers < 50) currentViewers = 50;
                viewerDisplay.textContent = `Ë¶ñËÅ¥ËÄÖ: ${currentViewers.toLocaleString()}‰∫∫`;
            }, 3000);
        }
    </script>
</body>
</html>
